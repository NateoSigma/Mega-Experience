<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Mega Experience</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #121212;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin: 15px 0;
      font-size: 28px;
      color: #ffcc00;
      text-shadow: 0 0 8px #ff8800;
    }

    /* ğŸ”² Nowy gÅ‚Ã³wny ukÅ‚ad */
#container {
  display: grid;
  grid-template-columns: 250px 220px 1fr 300px;
  gap: 20px;
  width: 95%;
  max-width: 1600px;
}

#boardWrapper {
  display: flex;
  flex-direction: column;
  align-items: center; /* wyÅ›rodkowanie poziome */
  justify-content: center; /* wyÅ›rodkowanie pionowe */
  width: 100%;
  height: 100%;
}

#board {
  display: grid;
  grid-template-columns: repeat(10, 50px);
  grid-template-rows: repeat(10, 50px);
  gap: 4px;
  background: #1e1e1e;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  margin-bottom: 15px;
}

.cell {
      width: 50px;
      height: 50px;
      background: #2a2a2a;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

.player {
  background: #4caf50 !important;
  z-index: 10;
}
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.overlay.visible {
  display: flex;
}

.overlay-content {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  width: 80%;
  text-align: center;
}
.player::after {
  content: "ğŸ™‚";
  font-size: 20px;
  z-index: 11;
}

    .skeleton::after { content: "ğŸ’€"; }
    .pig::after { content: "ğŸ–"; }
   	.sheep::after { content: "ğŸ‘"; }
    .cow::after { content: "ğŸ„"; }
    .wolf::after { content: "ğŸº"; }
    .spider::after { content: "ğŸ•·ï¸"; }
    .tree::after { content: "ğŸŒ³"; }
    .stick::after { content: "ğŸŒ¿"; }
    .stone::after { content: "ğŸª¨"; }
    .coal::after { content: "ğŸŒ‘"; }
    .carrot::after { content: "ğŸ¥•"; }
    .tomato::after { content: "ğŸ…"; }
    .sand::after { content: "ğŸŸ¡"; }
    .bamboo::after { content: "ğŸ‹"; }
    .cactus::after { content: "ğŸŒµ"; }
    .campfire::after { content: "ğŸ”¥"; }
    .pumpkin::after { content: "ğŸƒ"; } 

#controls {
  display: grid; /* ğŸ‘ˆ brakowaÅ‚o Å›rednika */
  grid-template-columns: repeat(3, 70px);
  grid-template-rows: repeat(3, 70px);
}
#merchantOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
  color: #fff;
  text-align: center;
  padding: 20px;
}
#merchantOverlay.visible {
  display: flex;
}

#merchantOverlay .panel {
  background: #222;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,0.7);
  max-width: 400px;
}
#merchantOverlay button {
  margin: 5px;
  padding: 10px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #4caf50;
  color: #fff;
  cursor: pointer;
}
#merchantOverlay button:hover {
  background: #66bb6a;
}
#updatePanel {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.6);
  font-size: 14px;
  text-align: left;
  width: 220px;
  margin-left: 20px;
}

#updatePanel h3 {
  margin-top: 0;
  color: #ffcc00;
  text-shadow: 0 0 6px #ff8800;
}

#updatePanel ul {
  padding-left: 18px;
  margin: 0;
}

#updatePanel li {
  list-style: "ğŸ”¹ ";
  margin: 4px 0;
}

#achievementsButton {
  position: fixed;
  bottom: 10px;
  left: 10px;
  padding: 10px 15px;
  font-size: 14px;
  border: none;
  border-radius: 8px;
  background: #444;
  color: #fff;
  cursor: pointer;
  z-index: 1000;
}
#achievementsButton:hover {
  background: #666;
}

#achievementsOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  color: #fff;
  overflow-y: auto;
}
#achievementsOverlay.visible {
  display: flex;
}

#achievementsPanel {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  max-width: 600px;
  width: 90%;
  text-align: left;
  box-shadow: 0 0 20px rgba(0,0,0,0.7);
}
#achievementsPanel h2 {
  text-align: center;
  margin-top: 0;
}
.achievement {
  margin-bottom: 15px;
  padding: 10px;
  border-radius: 8px;
  background: #2a2a2a;
}
.achievement h3 {
  margin: 0;
  font-size: 18px;
  color: #ffcc00;
}
.achievement p {
  margin: 5px 0 0;
  font-size: 14px;
  color: #ccc;
}
.spider {
  background-color: black;
  color: red;
}
.btn-reset {
  background: #c62828;
  color: #fff;
  font-size: 16px;
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  cursor: pointer;
  transition: 0.2s;
}
.message-bar {
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
  color: #fff;
  background: #1e1e1e;
  padding: 5px 10px;
  border-radius: 8px;
  min-height: 24px;
}
.btn-reset:hover {
  background: #e53935;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.5);
}

.btn-campfire {
  background: #ff8800;
  color: #fff;
  font-size: 16px;
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  cursor: pointer;
  transition: 0.2s;
}

.btn-campfire:hover {
  background: #ffaa33;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.5);
}

@keyframes fire-jump {
  0% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-3px) scale(1.1); }
  100% { transform: translateY(0) scale(1); }
}

@keyframes fire-flicker {
  0% { box-shadow: 0 0 10px #ff6600; }
  50% { box-shadow: 0 0 18px #ff9900; }
  100% { box-shadow: 0 0 10px #ff6600; }
}

    .btn {
      font-size: 28px;
      border: none;
      border-radius: 12px;
      background: #333;
      color: #fff;
      transition: 0.2s;
    }
    .btn:hover { background: #555; transform: scale(1.05); }

    /* ğŸ“¦ Inventory po lewej */
    #inventory {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      font-size: 14px;
      text-align: left;
    }

    #inventory h3 { margin-top: 0; }
    #inventory ul { padding-left: 18px; margin: 0; }
    #inventory li { list-style: "ğŸ”¹ "; margin: 3px 0; }

    .durability-bar {
      height: 8px;
      background: #444;
      border-radius: 5px;
      overflow: hidden;
      margin: 2px 0 6px;
    }
    .durability { height: 100%; background: #4caf50; }

    /* ğŸ“‹ Panel boczny */
    #sidebar {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #timeLabel {
      font-size: 20px;
      margin-bottom: 10px;
    }

    #mapSelector button,
    #actions button,
    #crafting button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }

    #mapSelector button { background: #444; color: #fff; }
    #mapSelector button:hover { background: #666; }

    #actions button { background: #4caf50; color: #fff; }
    #actions button:hover { background: #66bb6a; }

    #crafting button { background: #888; color: #fff; }
    #crafting button:hover { background: #aaa; }
  </style>
</head>
<body>

<h1>Mega Experience v1.04</h1>
<div id="container">

<div id="inventory"></div>

<div id="updatePanel">
  <h3>ğŸ“ Aktualizacja</h3>
  <ul>
    <li>Dodano Zupy</li>
    <li>Dodano Dynie</li>
    <li>Dodano Epeta</li>
    <li>Dodano DÅ¼ungle</li>
    <li>Dodano Bambus</li>
    <li>Ulepszono Ognisko</li>
    <li>Naprawiono BÅ‚Ä™dy</li>
  </ul>
</div>

	
<div id="merchantOverlay">
  <div class="panel" id="merchantUI"></div>
</div>

<div id="boardWrapper">
  <div id="gameMessage" class="message-bar"></div>
  <div id="board"></div>
  <div id="controls">
    <div></div><button class="btn" onclick="move('up')">W</button><div></div>
    <button class="btn" onclick="move('left')">A</button><div></div>
    <button class="btn" onclick="move('right')">D</button><div></div>
    <button class="btn" onclick="move('down')">S</button><div></div>
  </div>
</div>

    <!-- ğŸ“‹ Panel boczny -->
    <div id="sidebar">
      <div id="sidebar">
  <div id="timeLabel">ğŸŒ DzieÅ„</div>
  <div id="dayCounter">ğŸ“… DzieÅ„: 1</div>
  <div id="weatherLabel">â˜€ï¸ Pogoda: SÅ‚onecznie</div>
  <button onclick="resetGame()" style="background:#c62828;color:#fff;">ğŸ”„ Zresetuj grÄ™</button>
        <button onclick="useEpet()">ğŸ¤– UÅ¼yj Epeta</button>
        <button class="btn-campfire" onclick="placeCampfire()">ğŸ”¥ Postaw ognisko</button>
        <button class="btn-campfire" onclick="collectNearbyCampfire()">ğŸ”¥ WeÅº ognisko z mapy</button>

      <div id="mapSelector">
        <button onclick="setBiome('forest')">ğŸŒ² Las</button>
        <button onclick="setBiome('jungle')">ğŸŒ´ DÅ¼ungla</button>
        <button onclick="setBiome('desert')">ğŸœï¸ Pustynia</button>
        <button onclick="setBiome('cave')">â›° Jaskinia</button>
      </div>
      
<button onclick="shootBow('up')">â¬†ï¸ Strzel w gÃ³rÄ™</button>
<button onclick="shootBow('down')">â¬‡ï¸ Strzel w dÃ³Å‚</button>
<button onclick="shootBow('left')">â¬…ï¸ Strzel w lewo</button>
<button onclick="shootBow('right')">â¡ï¸ Strzel w prawo</button>

      <div id="actions">
        <button onclick="eatApple()">ğŸ Zjedz jabÅ‚ko (+2 HP)</button>
        <button onclick="eatTomato()">ğŸ… Zjedz pomidora (+0.5 HP)</button>
        <button onclick="eatCookedMeat()">ğŸ– Zjedz miÄ™so (+5 HP)</button>
        <button onclick="eatCarrot()">ğŸ¥• Zjedz marchewkÄ™ (+1 HP)</button>
        <button onclick="eatPumpkinSoup()">ğŸ² Zjedz ZupÄ™ DyniowÄ… (+ 3 HP)</button>
        <button onclick="eatTomatoSoup()">ğŸ² Zjedz ZupÄ™ PomidorowÄ… (+ 2 HP)</button>
      </div>

      <div id="crafting">
        <button onclick="craftAxe()"> Siekiera (3 patyki + 2 kamienia)</button>
        <button onclick="craftPickaxe()"> Kilof (7 patykÃ³w)</button>
        <button onclick="craftEpet()"> Epet (10 wÄ™gla + 5 kamiennego pyÅ‚u + 1 bambus)</button>
        <button onclick="craftStonePickaxe()">Kamienny kilof (3x kamieÅ„, 4x patyk)</button>
        <button onclick="craftSword()"> Miecz (3 patyki + 10 kamienia)</button>
        <button onclick="craftBow()"> Åuk (1 niÄ‡, 2 patyki)</button>
        <button onclick="craftArrow()"> StrzaÅ‚y (1 patyk + 1 kamieÅ„)</button>
        <button onclick="craftDagger()"> Sztylet (2 patyki + 7 kamienia)</button>
        <button onclick="craftArmor()"> Zbroja wilka (12 skÃ³ry wilka)</button>
        <button onclick="craftThread()"> NiÄ‡ (3x pajÄ™czyna)</button>
        <button onclick="craftBowl()"> Drewniana miska (1 Drewno)</button>
        <button onclick="craftSwissKnife()"> Scyzoryk szwajcarski (5 patykÃ³w + 8 kamienia)</button>
        <button onclick="craftChair()"> KrzesÅ‚o (2 drewna + 6 patykÃ³w)</button>
        <button onclick="craftCampfire()"> Ognisko (8 drewna + 4 wÄ™gla)</button>
      </div>
    </div>
  </div>
  <div id="ui"></div>
  
<button id="achievementsButton" onclick="openAchievements()">ğŸ† OsiÄ…gniÄ™cia</button>

<div id="achievementsOverlay">
  <div id="achievementsPanel">
    <h2>ğŸ† OsiÄ…gniÄ™cia</h2>
    <div id="achievementsList"></div>
    <button onclick="closeAchievements()" style="margin-top:15px;padding:8px 12px;border:none;border-radius:8px;background:#c62828;color:#fff;">Zamknij</button>
  </div>
</div>

<div id="cookingOverlay" class="overlay">
  <div class="overlay-content">
    <h2>ğŸ”¥ Gotowanie</h2>
    <button onclick="cookMeat()">ğŸ– Upiecz miÄ™so</button>
    <button onclick="cookTomatoSoup()">ğŸ² Ugotuj zupÄ™ pomidorowÄ… (4x pomidor)</button>
    <button onclick="cookPumpkinSoup()">ğŸ² Ugotuj zupÄ™ dyniowÄ… (2x dynia)</button>
    <button onclick="closeCooking()">âŒ Zamknij</button>
  </div>
</div>

<script>
const size = 10;
const board = document.getElementById('board');
let playerX = 0, playerY = 0, isDay = true;
let worldX = 0, worldY = 0;
let currentBiome = 'forest';
let playerHP = 20;
let merchant = null;
let worlds = {};
let day = 1;
let weather = "â˜€ï¸ SÅ‚onecznie"; 
const weathers = ["â˜€ï¸ SÅ‚onecznie", "ğŸŒ§ï¸ Deszcz", "â›ˆï¸ Burza"];

let inventory = {
  wood: 0,
  cookedMeat: 0,
  apples: 0,
  arrows: 0,
  bamboo: 0,
  cactus: 0,
  stones: 0,
  bones: 0,
  chairs: 0,
  cactusFlower: 0,
  carrots: 0,
  meat: 0,
  campfires: 0,
  spiderSilk: 0,
  bowl: 0,
  sticks: 0,
  sand: 0,
  tomatoes: 0,
  stoneDust: 0,
  wolfSkin: 0,
  wool: 0,
  thread: 0, 
  coal: 0,
  tomatoSoup: 0,
  pumpkinSoup: 0,
  pumpkins: 0,
  axe: false,
  axeDurability: 0,
  armor: false,
  swissKnife: false,
  swissKnifeDurability: 0,
  sword: false,
  swordDurability: 0,
  pickaxe: false,
  pickaxeDurability: 0,
  dagger: false,
  daggerDurability: 0,
  epet: false,
  bow: false,
  bowDurability: 0,
  stonePickaxe: false,
  stonePickaxeDurability: 0
};

let achievements = [
  { id: "firstBlood", title: "Pierwsza krew", desc: "Pokonaj pierwszego przeciwnika.", unlocked: false },
  { id: "wolfHunter", title: "Åowca wilkÃ³w", desc: "Zbierz 5 skÃ³r wilka.", unlocked: false },
  { id: "armorCrafter", title: "Pancerny wojownik", desc: "StwÃ³rz zbrojÄ™ ze skÃ³ry wilka.", unlocked: false },
  { id: "daySurvivor", title: "PrzetrwaÅ‚y", desc: "PrzeÅ¼yj 5 dni.", unlocked: false },
  { id: "shepherd", title: "Pasterz", desc: "ZdobÄ…dÅº weÅ‚nÄ™ od owcy.", unlocked: false },
  { id: "woodCollector", title: "Drwal", desc: "Zbierz 100 drewna.", unlocked: false },
  { id: "bowKill", title: "Szkielet z dystansu", desc: "Pokonaj szkieleta Å‚ukiem.", unlocked: false }
];

let sticks = [];
let stones = [];
let trees = [];
let campfires = [];
let carrots = [];
let pumpkins = [];
let bamboo = [];
let cows = [];
let arrows = [];
let spiders = [];
let sand = [];
let wolves = [];
let tomatoes = [];
let skeletons = [];
let coal = [];
let cacti = [];
let sheep = [];
let pigs = [];

function getCellIndex(x, y) {
  return y * size + x;
}

function setBiome(biome) {
  currentBiome = biome;
  generateMapForBiome();
  renderBoard();
}

function openAchievements() {
  renderAchievements();
  document.getElementById('achievementsOverlay').classList.add('visible');
}
function closeAchievements() {
  document.getElementById('achievementsOverlay').classList.remove('visible');
}

function renderAchievements() {
  let list = "";
  achievements.forEach(a => {
    list += `
      <div class="achievement" style="opacity:${a.unlocked ? 1 : 0.5}">
        <h3>${a.title}</h3>
        <p>${a.desc}</p>
        <p>Status: ${a.unlocked ? "âœ… Odblokowane" : "âŒ Zablokowane"}</p>
      </div>
    `;
  });
  document.getElementById('achievementsList').innerHTML = list;
}

function unlockAchievement(id) {
  const ach = achievements.find(a => a.id === id);
  if (ach && !ach.unlocked) {
    ach.unlocked = true;
    alert(`ğŸ† Odblokowano osiÄ…gniÄ™cie: ${ach.title}`);
    saveGame();
  }
}

function generateItems(arr, count) {
  let tries = 0;
  while (arr.length < count && tries < 1000) {
    const x = Math.floor(Math.random() * size);
    const y = Math.floor(Math.random() * size);
    const occupied = [sticks, stones, trees, pigs].some(group =>
      group.some(i => i.x === x && i.y === y)
    );
    if ((x !== playerX || y !== playerY) && !occupied) {
      arr.push({x, y});
    }
    tries++;
  }
}

function useEpet() {
  if (!inventory.epet) {
    showMessage("âŒ Nie masz Epeta!");
    return;
  }

  showMessage("ğŸ¤– Epet aktywowany! Zbiera wszystko wokÃ³Å‚ ciebie!");

  // zakres 3x3 wokÃ³Å‚ gracza
  for (let dx = -1; dx <= 1; dx++) {
    for (let dy = -1; dy <= 1; dy++) {
      if (dx === 0 && dy === 0) continue; // pomiÅ„ pole gracza

      const targetX = playerX + dx;
      const targetY = playerY + dy;

      // sprawdÅº kaÅ¼dy rodzaj obiektu
      sticks = collectNearby(sticks, targetX, targetY, "sticks", "ğŸŒ¿ Patyk");
      stones = collectNearby(stones, targetX, targetY, "stones", "ğŸª¨ KamieÅ„");
      trees = collectNearby(trees, targetX, targetY, "wood", "ğŸŒ³ Drewno");
      tomatoes = collectNearby(tomatoes, targetX, targetY, "tomatoes", "ğŸ… Pomidor");
      carrots = collectNearby(carrots, targetX, targetY, "carrots", "ğŸ¥• Marchewka");
      pumpkins = collectNearby(pumpkins, targetX, targetY, "pumpkins", "ğŸƒ Dynia");
      coal = collectNearby(coal, targetX, targetY, "coal", "ğŸŒ‘ WÄ™giel");
      bamboo = collectNearby(bamboo, targetX, targetY, "bamboo", "ğŸ‹ Bambus");
      sand = collectNearby(sand, targetX, targetY, "sand", "ğŸŸ¡ Piasek");
      cactus = collectNearby(cactus, targetX, targetY, "cactus", "ğŸŒµ Kaktus");
      sheep = collectNearby(sheep, targetX, targetY, "wool", "ğŸ‘ WeÅ‚na i miÄ™so", true);
      pigs = collectNearby(pigs, targetX, targetY, "meat", "ğŸ– MiÄ™so", true);
      cows = collectNearby(cows, targetX, targetY, "meat", "ğŸ„ MiÄ™so", true);
      wolves = collectNearby(wolves, targetX, targetY, "wolfSkin", "ğŸº SkÃ³ra wilka", true);
    }
  }

  updateInventory();
  renderBoard();
  saveGame();
}

function collectNearby(array, x, y, itemKey, itemName, enemy = false) {
  return array.filter(obj => {
    if (obj.x === x && obj.y === y) {
      if (enemy) {
        showMessage(`${itemName} zostaÅ‚ pokonany przez Epeta!`);
      } else {
        inventory[itemKey] = (inventory[itemKey] || 0) + 1;
        showMessage(`ğŸ¤– Epet zebraÅ‚ ${itemName}!`);
      }
      return false; // usuÅ„ z mapy
    }
    return true;
  });
}

function updateWeather() {
  if (Math.random() < 0.3) { 
    weather = weathers[Math.floor(Math.random() * weathers.length)];
  }
  document.getElementById('weatherLabel').textContent = `${weather}`;
}

function applyWeatherEffects() {
  if (weather.includes("ğŸŒ§ï¸")) {
    // deszcz â€“ wiÄ™ksza szansa na roÅ›liny
    generateItems(carrots, 2);
    generateItems(tomatoes, 2);
  }

  if (weather.includes("â›ˆï¸")) {
    // burza â€“ gracz dostaje obraÅ¼enia jeÅ›li nie stoi przy ognisku
    const nearCampfire = campfires.some(fire => 
      Math.abs(fire.x - playerX) <= 1 && Math.abs(fire.y - playerY) <= 1
    );

    if (!nearCampfire) {
      playerHP -= 1;
      if (playerHP <= 0) {
        alert("âš¡ ZginÄ…Å‚eÅ› raÅ¼ony piorunem w czasie burzy!");
        resetGame();
      }
    }
  }
}

function renderBoard() {
  board.innerHTML = '';
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      const cell = document.createElement('div');
      cell.className = 'cell';

      // Rysowanie innych obiektÃ³w
      if (merchant && merchant.x === x && merchant.y === y) {
        cell.classList.add('merchant');
        cell.textContent = 'ğŸ‘³';
      } else {
        const objMap = [
          { arr: sticks, cls: 'stick' },
          { arr: stones, cls: 'stone' },
          { arr: skeletons, cls: 'skeleton' },
          { arr: trees, cls: 'tree' },
          { arr: campfires, cls: 'campfire' },
          { arr: carrots, cls: 'carrot' },
          { arr: cows, cls: 'cow' },
          { arr: spiders, cls: 'spider' },
          { arr: sand, cls: 'sand' },
          { arr: bamboo, cls: 'bamboo' },
          { arr: wolves, cls: 'wolf' },
          { arr: tomatoes, cls: 'tomato' },
          { arr: coal, cls: 'coal' },
          { arr: cacti, cls: 'cactus' },
          { arr: sheep, cls: 'sheep' },
          { arr: pumpkins, cls: 'pumpkin' },
          { arr: pigs, cls: 'pig' }
        ];

        for (const { arr, cls } of objMap) {
          if (Array.isArray(arr) && arr.some(i => i.x === x && i.y === y)) {
            cell.classList.add(cls);
            break;
          }
        }
      }
      if (x === playerX && y === playerY) {
        cell.textContent = "ğŸ™‚";
        cell.style.backgroundColor = "#4caf50";
      }
      board.appendChild(cell);
    }
  }

  updateInventory();
  updateTimeLabel();
  saveGame();
}

function spawnMerchant() {
  // losowe miejsce poza graczem
  let x, y;
  do {
    x = Math.floor(Math.random() * size);
    y = Math.floor(Math.random() * size);
  } while (x === playerX && y === playerY);

  merchant = { x, y };
}
function showMessage(text) {
  const msgBox = document.getElementById("gameMessage");
  msgBox.textContent = text;

  setTimeout(() => {
    if (msgBox.textContent === text) {
      msgBox.textContent = "";
    }
  }, 7000);
}
function generateMapForBiome() {
  sticks = [];
  stones = [];
  sheep = [];
  trees = [];
  carrots = [];
  pigs = [];
  cows = [];
  tomatoes = [];
  pumpkins = [];

if (currentBiome === 'forest') {
  generateItems(sticks, 10);
  generateItems(stones, 4);
  generateItems(trees, 4);
  generateItems(cows, 2);
  generateItems(pigs, 2);
  generateItems(carrots, 3);
  generateItems(tomatoes, 3);
  generateItems(pumpkins, 3); 
  generateItems(sheep, 2);
}

  if (currentBiome === 'jungle') {
    generateItems(trees, 10); 
    generateItems(bamboo, 5); 
  }

  if (currentBiome === 'desert') {
    generateItems(sand, 10);
    generateItems(cacti, 3);
  }

  if (currentBiome === 'cave') {
    generateItems(stones, 8); 
    generateItems(spiders, 3); 
    generateItems(coal, 3);
  }
}

function collectNearbyCampfire() {
  for (let i = 0; i < campfires.length; i++) {
    const fire = campfires[i];
    const dx = Math.abs(fire.x - playerX);
    const dy = Math.abs(fire.y - playerY);

    // Gracz jest maksymalnie 1 kratkÄ™ od ogniska, ale nie na nim
    if ((dx <= 1 && dy <= 1) && !(dx === 0 && dy === 0)) {
      inventory.campfires = (inventory.campfires || 0) + 1;
      campfires.splice(i, 1); // usuÅ„ ognisko z mapy
      saveGame();
      renderBoard();
      updateInventory();
      return;
    }
  }
}

function move(dir) {
  if (dir === 'up') {
    if (playerY === 0) {
      worldY--;
      playerY = size - 1;
    } else {
      playerY--;
    }
  } else if (dir === 'down') {
    if (playerY === size - 1) {
      worldY++;
      playerY = 0;
    } else {
      playerY++;
    }
  } else if (dir === 'left') {
    if (playerX === 0) {
      worldX--;
      playerX = size - 1;
    } else {
      playerX--;
    }
  } else if (dir === 'right') {
    if (playerX === size - 1) {
      worldX++;
      playerX = 0;
    } else {
      playerX++;
    }
  }

  interact();
  moveSkeletons();
  moveWolves();
  renderBoard();
}

function isCellFree(x, y) {
  // Zwraca true, jeÅ›li kratka jest pusta (brak przeszkÃ³d)
  if (x < 0 || x >= size || y < 0 || y >= size) return false;
  const obstacles = [...trees, ...stones, ...cacti, ...campfires];
  return !obstacles.some(obj => obj.x === x && obj.y === y);
}

function moveWolves() {
  for (let wolf of wolves) {
    let dx = playerX - wolf.x;
    let dy = playerY - wolf.y;

    let moved = false;

    // SprÃ³buj ruch w osi X
    if (Math.abs(dx) > Math.abs(dy)) {
      const nx = wolf.x + Math.sign(dx);
      if (isCellFree(nx, wolf.y)) {
        wolf.x = nx;
        moved = true;
      }
    }

    // JeÅ›li nie przeszedÅ‚ w X lub X byÅ‚o krÃ³tsze, sprÃ³buj Y
    if (!moved && dy !== 0) {
      const ny = wolf.y + Math.sign(dy);
      if (isCellFree(wolf.x, ny)) {
        wolf.y = ny;
        moved = true;
      }
    }

    // JeÅ›li nie moÅ¼na w X ani Y, sprÃ³buj ruch alternatywny (np. losowo)
    if (!moved) {
      const dirs = [
        [1,0], [-1,0], [0,1], [0,-1]
      ].sort(() => Math.random() - 0.5); // losowa kolejnoÅ›Ä‡
      for (const [dxAlt, dyAlt] of dirs) {
        if (isCellFree(wolf.x + dxAlt, wolf.y + dyAlt)) {
          wolf.x += dxAlt;
          wolf.y += dyAlt;
          break;
        }
      }
    }
  }
}

function moveSkeletons() {
  for (let skel of skeletons) {
    let dx = playerX - skel.x;
    let dy = playerY - skel.y;

    let moved = false;

    // SprÃ³buj ruch w osi X
    if (Math.abs(dx) > Math.abs(dy)) {
      const nx = skel.x + Math.sign(dx);
      if (isCellFree(nx, skel.y)) {
        skel.x = nx;
        moved = true;
      }
    }

    // JeÅ›li nie przeszedÅ‚ w X lub X byÅ‚o krÃ³tsze, sprÃ³buj Y
    if (!moved && dy !== 0) {
      const ny = skel.y + Math.sign(dy);
      if (isCellFree(skel.x, ny)) {
        skel.y = ny;
        moved = true;
      }
    }

    // JeÅ›li nie moÅ¼na w X ani Y, sprÃ³buj ruch alternatywny (np. losowo)
    if (!moved) {
      const dirs = [
        [1,0], [-1,0], [0,1], [0,-1]
      ].sort(() => Math.random() - 0.5); // losowa kolejnoÅ›Ä‡
      for (const [dxAlt, dyAlt] of dirs) {
        if (isCellFree(skel.x + dxAlt, skel.y + dyAlt)) {
          skel.x += dxAlt;
          skel.y += dyAlt;
          break;
        }
      }
    }
  }
}

function interact() {
  sticks = sticks.filter(i => {
    if (i.x === playerX && i.y === playerY) {
      inventory.sticks++;
      showMessage("ğŸŒ¿ ZebraÅ‚eÅ› 1x patyk!");
      return false;
    }
    return true;
  });
stones = stones.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.pickaxe) {
      inventory.stones++;
      inventory.pickaxeDurability--;
      if (inventory.pickaxeDurability <= 0) {
        inventory.pickaxe = false;
        showMessage("â›ï¸ TwÃ³j kilof siÄ™ zepsuÅ‚!");
      }
      return false;
    } else if (inventory.swissKnife) {
      inventory.stoneDust++;
      inventory.swissKnifeDurability--;
      if (inventory.swissKnifeDurability <= 0) {
        inventory.swissKnife = false;
        showMessage("ğŸ‡¨ğŸ‡­ TwÃ³j scyzoryk siÄ™ zuÅ¼yÅ‚!");
      }
      return false;
    } else {
      showMessage("âŒ Potrzebujesz kilofa â›ï¸ albo scyzoryka ğŸ‡¨ğŸ‡­, Å¼eby coÅ› zebraÄ‡!");
    }
  }
  return true;
});
spiders = spiders.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.dagger) {
      inventory.spiderSilk = (inventory.spiderSilk || 0) + 1;
      showMessage("ğŸ•·ï¸ PokonaÅ‚eÅ› pajÄ…ka i zdobyÅ‚eÅ› pajÄ™czynÄ™!");
      inventory.daggerDurability--;
      if (inventory.daggerDurability <= 0) inventory.dagger = false;
      return false;
    } else {
      let dmg = 2;
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8);
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          showMessage("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;
      if (playerHP <= 0) {
        showMessage("ğŸ’€ PajÄ…k ciÄ™ zabiÅ‚!");
        resetGame();
        return false;
      }
    }
  }
  return true;
});
  sand = sand.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    inventory.sand = (inventory.sand || 0) + 1;
    showMessage("ZebraÅ‚eÅ› 1x Piasek!");
    return false;
  }
  return true;
});
carrots = carrots.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    inventory.carrots = (inventory.carrots || 0) + 1;
    showMessage("ZebraÅ‚eÅ› 1x MarchewkÄ™!");
    return false; 
  }
  return true;
});
tomatoes = tomatoes.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    inventory.tomatoes = (inventory.tomatoes || 0) + 1;
    showMessage("ğŸ… ZebraÅ‚eÅ› 1x pomidora!");
    return false; 
  }
  return true;
});
pumpkins = pumpkins.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    inventory.pumpkins = (inventory.pumpkins || 0) + 1;
    showMessage("ğŸƒ ZebraÅ‚eÅ› 1x dyniÄ™!");
    return false; 
  }
  return true;
});
sheep = sheep.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.dagger || inventory.sword) {
      inventory.meat = (inventory.meat || 0) + 1;
      inventory.wool = (inventory.wool || 0) + 1;

      let dmg = 2; // przykÅ‚adowe obraÅ¼enia
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8);
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          showMessage("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;

      showMessage("ğŸ‘ ZebraÅ‚eÅ› 1x miÄ™so i 1x weÅ‚nÄ™!");
      return false;
    } else {
      playerHP--;
      if (playerHP <= 0) {
        alert("ğŸ’€ ZginÄ…Å‚eÅ› od owcy!");
        resetGame();
      }
    }
  }
  return true;
});
coal = coal.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.stonePickaxe) {
      inventory.coal = (inventory.coal || 0) + 1;
      inventory.stonePickaxeDurability--;
      if (inventory.stonePickaxeDurability <= 0) {
        inventory.stonePickaxe = false;
        showMessage("â›ï¸ TwÃ³j kamienny kilof siÄ™ zepsuÅ‚!");
      }
      return false;
    } else {
      showMessage("âŒ Potrzebujesz kamiennego kilofa, Å¼eby wykopaÄ‡ wÄ™giel!");
    }
  }
  return true;
});
campfires.forEach(fire => {
  if (fire.x === playerX && fire.y === playerY) {
    openCooking(); 
  }
});
if (merchant && playerX === merchant.x && playerY === merchant.y) {
  openMerchantTrade();
}
bamboo = bamboo.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    inventory.bamboo = (inventory.bamboo || 0) + 1;
    showMessage("ğŸ‹ ZebraÅ‚eÅ› 1x bambus!");
    return false; // usuÅ„ z mapy po zebraniu
  }
  return true;
});
wolves = wolves.filter(wolf => {
  if (wolf.x === playerX && wolf.y === playerY) {
    if (inventory.sword) {
      inventory.swordDurability--;
      if (inventory.swordDurability <= 0) {
        inventory.sword = false;
        showMessage("ğŸ—¡ï¸ TwÃ³j miecz siÄ™ zepsuÅ‚!");
      }
      inventory.wolfSkin = (inventory.wolfSkin || 0) + 1;
      unlockAchievement("firstBlood");
      showMessage("ğŸº ZebraÅ‚eÅ› 1x skÃ³rÄ™ wilka!");
      if (inventory.wolfSkin >= 5) unlockAchievement("wolfHunter");
      return false;
    } else {
      // wilk gryzie gracza
      let dmg = 3;
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8);
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          showMessage("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;
      if (playerHP <= 0) {
        showMessage("ğŸ’€ ZginÄ…Å‚eÅ› rozszarpany przez wilki!");
        resetGame();
        return false;
      }
    }
  }
  return true;
});
skeletons = skeletons.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.sword) {
      inventory.bones = (inventory.bones || 0) + 1;

      // ğŸ† osiÄ…gniÄ™cie tylko za szkieleta
      unlockAchievement("firstBlood");

      inventory.swordDurability--;
      if (inventory.swordDurability <= 0) {
        inventory.sword = false;
        showMessage("ğŸ—¡ï¸ TwÃ³j miecz siÄ™ zepsuÅ‚!");
      }

      return false; // szkielet pokonany
    } else {
      // obraÅ¼enia od szkieleta
      let dmg = 2;
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8); // redukcja 20%
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          showMessage("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;

      if (playerHP <= 0) {
        showMessage("ğŸ’€ ZginÄ…Å‚eÅ› od szkieleta! Gra zostaÅ‚a zresetowana.");
        resetGame();
        return false;
      }
    }
  }
  return true;
});
cacti = cacti.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    let dmg = 1;
    if (inventory.armor) {
      dmg = Math.ceil(dmg * 0.8); // redukcja 20%
      inventory.armorDurability--;
      if (inventory.armorDurability <= 0) {
        inventory.armor = false;
        showMessage("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
      }
    }
    playerHP -= dmg;

    inventory.cactus = (inventory.cactus || 0) + 1;
    if (Math.random() < 0.07) {
      inventory.cactusFlower = (inventory.cactusFlower || 0) + 1;
    }

    saveGame();

    if (playerHP <= 0) {
      showMessage("ğŸ’€ Kaktus ciÄ™ zabiÅ‚!");
      resetGame();
      return false;
    }
    return false;
  }
  return true;
});
trees = trees.filter(i => {
  if (i.x === playerX && i.y === playerY && inventory.axe) {
    // dodanie drewna
    inventory.wood = (inventory.wood || 0) + 1;

    // sprawdzenie osiÄ…gniÄ™cia Drwal
    if (inventory.wood >= 100) {
      unlockAchievement("woodCollector"); // ğŸ† Drwal â€“ Zbierz 100 drewna
    }

    // szansa na jabÅ‚ko
    if (Math.random() < 0.2) {
      inventory.apples = (inventory.apples || 0) + 1;
    }

    // zuÅ¼ywanie siekiery
    inventory.axeDurability--;
    if (inventory.axeDurability <= 0) {
      inventory.axe = false;
      inventory.axeDurability = 0;
    }

    return false; // usuÅ„ drzewo z mapy
  }
  return true;
});
cows = cows.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.dagger || inventory.sword) {
      inventory.meat += 2;
      unlockAchievement("firstBlood");
      if (inventory.dagger) {
        inventory.daggerDurability--;
        if (inventory.daggerDurability <= 0) inventory.dagger = false;
      }
      if (inventory.sword) {
        inventory.swordDurability--;
        if (inventory.swordDurability <= 0) inventory.sword = false;
      }
      return false;
    } else {
      let dmg = 1; // obraÅ¼enia od krowy
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8); // redukcja 20%
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          alert("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;

      if (playerHP <= 0) {
        alert("ğŸ’€ ZginÄ…Å‚eÅ› stratowany przez krowÄ™!");
        resetGame();
        return false;
      }
    }
  }
  return true;
});
pigs = pigs.filter(i => {
  if (i.x === playerX && i.y === playerY) {
    if (inventory.dagger) {
      inventory.meat++;
      unlockAchievement("firstBlood");
      inventory.daggerDurability--;
      if (inventory.daggerDurability <= 0) inventory.dagger = false;
      return false;
    } else {
      let dmg = 1; // obraÅ¼enia od Å›wini
      if (inventory.armor) {
        dmg = Math.ceil(dmg * 0.8); // redukcja 20%
        inventory.armorDurability--;
        if (inventory.armorDurability <= 0) {
          inventory.armor = false;
          alert("ğŸ›¡ï¸ Twoja zbroja siÄ™ zniszczyÅ‚a!");
        }
      }
      playerHP -= dmg;

      saveGame();

      if (playerHP <= 0) {
        alert("ğŸ’€ ZginÄ…Å‚eÅ›! Tracisz caÅ‚y ekwipunek.");
        inventory = {
          sticks: 0, stones: 0, wood: 0, meat: 0, apples: 0,
          tomatoes: 0, sand: 0, cactus: 0, chairs: 0,
          axe: false, axeDurability: 0,
          dagger: false, daggerDurability: 0
        };
        playerHP = 20;
        playerX = 0;
        playerY = 0;
        worldX = 0;
        worldY = 0;
        generateMapForBiome();
        renderBoard();
        return false;
      }
    }
  }
  return true;
});    
}

function shootBow(direction) {
  if (!inventory.bow) {
    showMessage("âŒ Nie masz Å‚uku!");
    return;
  }
  if (inventory.arrows <= 0) {
    showMessage("âŒ Brak strzaÅ‚!");
    return;
  }

  inventory.arrows--;

  let dx = 0, dy = 0;
  if (direction === "up") dy = -1;
  if (direction === "down") dy = 1;
  if (direction === "left") dx = -1;
  if (direction === "right") dx = 1;

  let x = playerX + dx;
  let y = playerY + dy;

  while (x >= 0 && x < size && y >= 0 && y < size) {
    // blokada przez drzewo lub kamieÅ„
    if (trees.some(t => t.x === x && t.y === y) || stones.some(s => s.x === x && s.y === y)) {
      showMessage("ğŸ¹ StrzaÅ‚a uderzyÅ‚a w przeszkodÄ™!");
      break;
    }

    // trafienie w przeciwnika
    let hit = false;

    wolves = wolves.filter(w => {
      if (w.x === x && w.y === y) {
        showMessage("ğŸ¹ TrafiÅ‚eÅ› wilka!");
        inventory.wolfSkin = (inventory.wolfSkin || 0) + 1;
        hit = true;
        return false;
      }
      return true;
    });

    skeletons = skeletons.filter(s => {
      if (s.x === x && s.y === y) {
        showMessage("ğŸ¹ TrafiÅ‚eÅ› szkieleta!");
        inventory.bones = (inventory.bones || 0) + 1;
        hit = true;
        return false;
      }
      return true;
    });

    spiders = spiders.filter(sp => {
      if (sp.x === x && sp.y === y) {
        showMessage("ğŸ¹ TrafiÅ‚eÅ› pajÄ…ka!");
        inventory.spiderSilk = (inventory.spiderSilk || 0) + 1;
        hit = true;
        return false;
      }
      return true;
    });

    if (hit) break; // strzaÅ‚a znika po trafieniu

    x += dx;
    y += dy;
  }

  updateInventory();
  renderBoard();
  saveGame();
}

function eatApple() {
  if (inventory.apples > 0 && playerHP < 20) {
    inventory.apples--;
    playerHP = Math.min(playerHP + 2, 20);
    saveGame();
    renderBoard();
  } else {
    showMessage("Nie masz jabÅ‚ek lub masz peÅ‚ne zdrowie!");
  }
}

function eatTomato() {
  if ((inventory.tomatoes || 0) > 0 && playerHP < 20) {
    inventory.tomatoes--;
    playerHP = Math.min(playerHP + 0.5, 20);
    saveGame();
    renderBoard();
  } else {
    showMessage("Nie masz pomidorÃ³w lub masz peÅ‚ne zdrowie!");
  }
}

function eatCookedMeat() {
  if (inventory.cookedMeat > 0 && playerHP < 20) {
    inventory.cookedMeat--;
    playerHP = Math.min(20, playerHP + 5);
    renderBoard();
  }
}

function eatTomatoSoup() {
  if ((inventory.tomatoSoup || 0) > 0) {
    inventory.tomatoSoup--;
    playerHP = Math.min(playerHP + 2, 20);
    showMessage("ğŸ² ZjadÅ‚eÅ› zupÄ™ pomidorowÄ… i odzyskaÅ‚eÅ› 2 HP!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Nie masz zupy pomidorowej!");
  }
}

function eatPumpkinSoup() {
  if ((inventory.pumpkinSoup || 0) > 0) {
    inventory.pumpkinSoup--;
    playerHP = Math.min(playerHP + 3, 20); // leczy +3 HP
    showMessage("ğŸƒğŸ² ZjadÅ‚eÅ› zupÄ™ dyniowÄ… i odzyskaÅ‚eÅ› 3 HP!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Nie masz zupy dyniowej!");
  }
}

function eatCarrot() {
  if ((inventory.carrots || 0) > 0 && playerHP < 20) {
    inventory.carrots--;
    playerHP = Math.min(20, playerHP + 1);
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Nie masz marchewek lub masz peÅ‚ne zdrowie!");
  }
}

function updateInventory() {
  if (!inventory) inventory = {};

  let inv = `
    <h3>ğŸ’ Ekwipunek:</h3>
    <ul style="text-align: left; line-height: 1.6;">
      <li>Bambus: ${inventory.bamboo || 0}</li>
      <li>Drewno: ${inventory.wood || 0}</li>
      <li>Dynie: ${inventory.pumpkins || 0}</li>
      <li>Gotowe miÄ™so: ${inventory.cookedMeat || 0}</li>
      <li>JabÅ‚ka: ${inventory.apples || 0}</li>
      <li>Kaktusy: ${inventory.cactus || 0}</li>
      <li>Kamienie: ${inventory.stones || 0}</li>
      <li>KoÅ›ci: ${inventory.bones || 0}</li>
      <li>KrzesÅ‚o: ${inventory.chairs || 0}</li>
      <li>Kwiaty kaktusa: ${inventory.cactusFlower || 0}</li>
      <li>Marchewki: ${inventory.carrots || 0}</li>
      <li>MiÄ™so: ${inventory.meat || 0}</li>
      <li>Miska: ${inventory.bowl || 0}</li>
      <li>NiÄ‡: ${inventory.thread || 0}</li>
      <li>Ogniska: ${inventory.campfires || 0}</li>
      <li>PajÄ™czyna: ${inventory.spiderSilk || 0}</li>
      <li>Patyki: ${inventory.sticks || 0}</li>
      <li>Piasek: ${inventory.sand || 0}</li>
      <li>Pomidory: ${inventory.tomatoes || 0}</li>
      <li>PyÅ‚ kamienny: ${inventory.stoneDust || 0}</li>
      <li>SkÃ³ra wilka: ${inventory.wolfSkin || 0}</li>
      <li>StrzaÅ‚y ${inventory.arrows || 0}</li>
      <li>WeÅ‚na: ${inventory.wool || 0}</li>
      <li>WÄ™giel: ${inventory.coal || 0}</li>
      <li>Zupa dyniowa: ${inventory.pumpkinSoup || 0}</li>
      <li>Zupa pomidorowa: ${inventory.tomatoSoup || 0}</li>
    </ul>

    <p>â¤ï¸ Zdrowie: ${playerHP.toFixed(1)}/20</p>
    <div class="durability-bar">
      <div class="durability" style="width:${playerHP * 5}%; background:#f44336;"></div>
    </div>
  `;

  const items = [
    { name: 'axe', label: 'ğŸª“ Siekiera', maxDur: 15 },
    { name: 'swissKnife', label: 'ğŸ‡¨ğŸ‡­ Scyzoryk szwajcarski', maxDur: 20 },
    { name: 'sword', label: 'ğŸ—¡ï¸ Miecz', maxDur: 10 },
    { name: 'bow', label: 'ğŸ¹ Åuk', maxDur: 15 },
    { name: 'pickaxe', label: 'â›ï¸ Kilof', maxDur: 12 },
    { name: 'stonePickaxe', label: 'â›ï¸ Kamienny Kilof', maxDur: 20 },
    { name: 'dagger', label: 'ğŸ”ª Sztylet', maxDur: 7 }
  ];

  items.forEach(item => {
    if (inventory[item.name]) {
      const dur = inventory[`${item.name}Durability`] || 0;
      inv += `
        <p>${item.label} (WytrzymaÅ‚oÅ›Ä‡: ${dur}/${item.maxDur})</p>
        <div class="durability-bar">
          <div class="durability" style="width:${(dur / item.maxDur) * 100}%;"></div>
        </div>
      `;
    }
  });

  if (inventory.armor) {
    inv += `<p>ğŸ›¡ï¸ Zbroja â€“ redukcja obraÅ¼eÅ„ 20%</p>`;
  }
  
if (inventory.epet) {
  inv += `<p>ğŸ¤– Epet: Aktywny <button onclick="useEpet()">UÅ¼yj</button></p>`;
} else {
  inv += `<p>ğŸ¤– Epet: Brak</p>`;
}


  document.getElementById('inventory').innerHTML = inv;
}

function craftAxe() {
  if (inventory.sticks >= 3 && inventory.stones >= 2) {
    inventory.sticks -= 3;
    inventory.stones -= 2;
    inventory.axe = true;
    inventory.axeDurability = 15;
    renderBoard();
  }
}

function craftArrow() {
  if ((inventory.sticks || 0) >= 1 && (inventory.stones || 0) >= 1) {
    inventory.sticks--;
    inventory.stones--;
    inventory.arrows = (inventory.arrows || 0) + 5; // 1 patyk + 1 kamieÅ„ = 5 strzaÅ‚
    showMessage("ğŸ¹ StworzyÅ‚eÅ› 5 strzaÅ‚!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz: 1x patyk i 1x kamieÅ„!");
  }
}

function craftStonePickaxe() {
  if ((inventory.stones || 0) >= 3 && (inventory.sticks || 0) >= 4) {
    inventory.stones -= 3;
    inventory.sticks -= 4;

    inventory.stonePickaxe = true;
    inventory.stonePickaxeDurability = 20; 

    showMessage("â›ï¸ StworzyÅ‚eÅ› kamienny kilof!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz 3x kamieÅ„ i 4x patyk!");
  }
}

function craftEpet() {
  if ((inventory.coal || 0) >= 10 && (inventory.stoneDust || 0) >= 5) {
    inventory.coal -= 10;
    inventory.stoneDust -= 5;
    inventory.bamboo -= 1;
    inventory.epet = true;
    showMessage("ğŸ¤– StworzyÅ‚eÅ› Epeta! Zbiera wszystko wokÃ³Å‚ ciebie!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz 10 wÄ™gla i 5 kamiennego pyÅ‚u, aby stworzyÄ‡ Epeta!");
  }
}

function craftArmor() {
  if ((inventory.wolfSkin || 0) >= 12) {
    inventory.wolfSkin -= 12;
    inventory.armor = true;
    inventory.armorDurability = 30; 
    showMessage("ğŸ›¡ï¸ UdaÅ‚o Ci siÄ™ stworzyÄ‡ zbrojÄ™! Otrzymujesz 20% odpornoÅ›ci na obraÅ¼enia.");
    unlockAchievement("armorCrafter");
    updateInventory();
  } else {
    showMessage("âŒ Potrzebujesz 12x skÃ³ry wilka.");
  }
}


function craftBowl() {
  if (inventory.wood  >= 1) {
    inventory.wood -= 1;
    inventory.bowl = (inventory.bowl || 0) + 1;
    updateInventory();
    saveGame();
    showMessage("UdaÅ‚o siÄ™ stworzyÄ‡ miskÄ™!");
  } else {
    showMessage("âŒ Potrzebujesz 1 drewno.");
  }
}

function craftBow() {
  if ((inventory.thread || 0) >= 1 && (inventory.sticks || 0) >= 2) {
    inventory.thread -= 1;
    inventory.sticks -= 2;
    inventory.bow = true;
    inventory.bowDurability = 15; 
    inventory.bow = (inventory.bow || 0) + 1;
    updateInventory();
    saveGame();
    showMessage("UdaÅ‚o siÄ™ stworzyÄ‡ Å‚uk!");
  } else {
    showMessage("âŒ Potrzebujesz 2x patyki i 1 niÄ‡.");
  }
}

function craftChair() {
  if ((inventory.wood || 0) >= 2 && (inventory.sticks || 0) >= 6) {
    inventory.wood -= 2;
    inventory.sticks -= 6;
    inventory.chairs = (inventory.chairs || 0) + 1;
    updateInventory();
    saveGame();
    showMessage("ğŸª‘ UdaÅ‚o siÄ™ stworzyÄ‡ krzesÅ‚o!");
  } else {
    showMessage("âŒ Potrzebujesz 2x drewno i 6x patykÃ³w.");
  }
}

function craftPickaxe() {
  if (inventory.sticks >= 7) {
    inventory.sticks -= 7;
    inventory.pickaxe = true;
    inventory.pickaxeDurability = 12; // np. 12 uÅ¼yÄ‡
    renderBoard();
  } else {
    showMessage("âŒ Potrzebujesz 7x patyk .");
  }
}

function craftThread() {
  if ((inventory.spiderSilk || 0) >= 3) {
    inventory.spiderSilk -= 3;
    inventory.thread = (inventory.thread || 0) + 1;
    alert("ğŸ§µ StworzyÅ‚eÅ› 1x niÄ‡ z 3 pajÄ™czyn!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz co najmniej 3 pajÄ™czyn, aby zrobiÄ‡ niÄ‡!");
  }
}

function craftSwissKnife() {
  if (inventory.sticks >= 5 && inventory.stones >= 8) {
    inventory.sticks -= 5;
    inventory.stones -= 8;
    inventory.swissKnife = true;
    inventory.swissKnifeDurability = 20; // 20 uÅ¼yÄ‡
    renderBoard();
    updateInventory();
    showMessage("ğŸ”ª StworzyÅ‚eÅ› Scyzoryk szwajcarski!");
  } else {
    showMessage("âŒ Potrzebujesz 5 patykÃ³w i 8 kamieni!");
  }
}

function craftCampfire() {
  if (inventory.wood >= 8 && inventory.coal >= 4) {
    inventory.wood -= 8;
    inventory.coal -= 4;
    inventory.campfires = (inventory.campfires || 0) + 1;
    renderBoard();
  }
}

function placeCampfire() {
  if (inventory.campfires > 0) {
    campfires.push({ x: playerX, y: playerY });
    inventory.campfires--;
    renderBoard();
  } else {
    showMessage("Nie masz ogniska do postawienia!");
  }
}

function craftDagger() {
  if (inventory.sticks >= 2 && inventory.stones >= 7) {
    inventory.sticks -= 2;
    inventory.stones -= 7;
    inventory.dagger = true;
    inventory.daggerDurability = 7;
    renderBoard();
  }
}

function craftSword() {
  if (inventory.sticks >= 3 && inventory.stones >= 10) {
    inventory.sticks -= 3;
    inventory.stones -= 10;
    inventory.sword = true;
    inventory.swordDurability = 10;
    renderBoard();
  }
}

function getWorldKey() {
  return `${worldX},${worldY}`;
}

function getCurrentWorld() {
  const key = getWorldKey();
  if (!worlds[key]) {
    worlds[key] = {
      sticks: [], stones: [], trees: [], pigs: [], tomatoes: []
    };
    generateItems(worlds[key].sticks, 10);
    generateItems(worlds[key].stones, 10);
    generateItems(worlds[key].trees, 5);
    generateItems(worlds[key].pigs, 4);
    generateItems(worlds[key].tomatoes, 2);
  }
  return worlds[key];
}

function updateTimeLabel() {
  const label = document.getElementById('timeLabel');
  label.textContent = isDay ? 'ğŸŒ DzieÅ„' : 'ğŸŒ™ Noc';
  document.body.style.backgroundColor = isDay ? '#1e1e1e' : '#000';
  if (currentBiome === 'cave') {
    document.body.style.backgroundColor = '#222'; // ciemniejsze tÅ‚o
  }
}

function updateDayCounter() {
  document.getElementById('dayCounter').textContent = `ğŸ“… DzieÅ„: ${day}`;
}

function toggleDayNight() {
  isDay = !isDay;
  day++;
  
  // Noc: pojawiajÄ… siÄ™ szkielety
  if (!isDay) {
    generateItems(skeletons, 3);
    if (currentBiome === 'forest') {
      generateItems(wolves, 2); // pojawiajÄ… siÄ™ tylko w lesie
    }
  } else {
    skeletons = [];
    wolves = [];
  }

  // DzieÅ„: odÅ›wieÅ¼enie surowcÃ³w
  if (isDay) {
    sticks = [];
    stones = [];
    trees = [];
    pigs = [];

    generateItems(sticks, 10);
    generateItems(stones, 10);
    generateItems(trees, 5);
    generateItems(carrots, 5);
    generateItems(pigs, 4);
  }

  // Kupiec co 2 dni
  if (day % 2 === 0) {
    spawnMerchant();
  } else {
    merchant = null;
  }
  
  if (day >= 5) {
    unlockAchievement("daySurvivor");
  }

  updateWeather();
  applyWeatherEffects();
  updateTimeLabel();
  updateDayCounter();
  renderBoard();
  saveGame();
}

function openCooking() {
  document.getElementById("cookingOverlay").classList.add("visible");
}

function closeCooking() {
  document.getElementById("cookingOverlay").classList.remove("visible");
}

function cookMeat() {
  if ((inventory.meat || 0) > 0) {
    const cooked = inventory.meat;
    inventory.meat = 0;
    inventory.cookedMeat = (inventory.cookedMeat || 0) + cooked;
    showMessage(`ğŸ– UgotowaÅ‚eÅ› ${cooked}x miÄ™so!`);
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Nie masz miÄ™sa do ugotowania!");
  }
}

function cookTomatoSoup() {
  if ((inventory.tomatoes || 0) >= 2 && (inventory.bowl || 0) >= 1) {
    inventory.tomatoes -= 4;
    inventory.bowl--;
    inventory.tomatoSoup = (inventory.tomatoSoup || 0) + 1;
    showMessage("ğŸ² UgotowaÅ‚eÅ› zupÄ™ pomidorowÄ…!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz 4 pomidorÃ³w i miskÄ™ do ugotowania zupy!");
  }
}

function cookPumpkinSoup() {
  if ((inventory.pumpkins || 0) >= 2 && (inventory.bowl || 0) >= 1) {
    inventory.pumpkins -= 2;
    inventory.bowl--; 
    inventory.pumpkinSoup = (inventory.pumpkinSoup || 0) + 1;
    showMessage("ğŸ² UgotowaÅ‚eÅ› zupÄ™ dyniowÄ…!");
    updateInventory();
    saveGame();
  } else {
    showMessage("âŒ Potrzebujesz 2 dyni i 1 miski, aby ugotowaÄ‡ zupÄ™ dyniowÄ…!");
  }
}

function openMerchantTrade() {
  const possibleTrades = [
    { from: 'sticks', fromAmt: 5, to: 'apples', toAmt: 1, text: "5x Patyk â†’ 1x JabÅ‚ko" },
    { from: 'stones', fromAmt: 3, to: 'meat', toAmt: 1, text: "3x KamieÅ„ â†’ 1x MiÄ™so" },
    { from: 'bones', fromAmt: 2, to: 'wood', toAmt: 3, text: "2x KoÅ›Ä‡ â†’ 3x Drewno" },
    { from: 'chairs', fromAmt: 2, to: 'tomatoSoup', toAmt: 1, text: "2x KrzesÅ‚o â†’ 1x Zupa Pomidorowa" },
    { from: 'cactusFlower', fromAmt: 1, to: 'dagger', toAmt: 1, text: "1x Kwiat kaktusa â†’ 1x Sztylet" },
    { from: 'stones', fromAmt: 10, to: 'sword', toAmt: 1, text: "10x KamieÅ„ â†’ 1x Miecz" }
  ];

  const offers = [];
  while (offers.length < 3) {
    const offer = possibleTrades[Math.floor(Math.random() * possibleTrades.length)];
    if (!offers.includes(offer)) offers.push(offer);
  }

  let html = `<h3>ğŸ‘³ Kupiec</h3><p>Witaj, oto moje oferty:</p>`;
  offers.forEach(o => {
    html += `<button onclick="trade('${o.from}', ${o.fromAmt}, '${o.to}', ${o.toAmt})">${o.text}</button><br>`;
  });
  html += `<button onclick="closeMerchant()">Zamknij</button>`;

  document.getElementById('merchantUI').innerHTML = html;
  document.getElementById('merchantOverlay').classList.add('visible');
}

function trade(from, fromAmt, to, toAmt) {
  if ((inventory[from] || 0) >= fromAmt) {
    inventory[from] -= fromAmt;
    inventory[to] = (inventory[to] || 0) + toAmt;
    updateInventory();
  } else {
    showMessage("âŒ Za maÅ‚o zasobÃ³w do wymiany.");
  }
}

function saveGame() {
  localStorage.setItem('survivalGame', JSON.stringify({
    playerX, playerY, inventory, sticks, stones, trees, cows, coal, pigs, tomatoes, sand, campfires, isDay, playerHP, day, weather, achievements, sheep, bamboo, spider
  }));
}

function closeMerchant() {
  document.getElementById('merchantOverlay').classList.remove('visible');
  document.getElementById('merchantUI').innerHTML = '';
}

function loadGame() {
  try {
    const data = JSON.parse(localStorage.getItem('survivalGame'));
    if (data) {
      playerX = data.playerX;
      playerY = data.playerY;
      inventory = data.inventory;
      sticks = data.sticks;
      stones = data.stones;
      spiderSilk = data.spiderSilk;
      trees = data.trees;
      bamboo = data.trees;
      pigs = data.pigs;
      spider = data.spider;
      campfires = data.campfires || [];
      tomatoes = data.tomatoes || [];
      isDay = data.isDay;
      weather = data.weather || "â˜€ï¸ SÅ‚onecznie";
      sand = data.sand || [];
      coal = data.coal || [];
      sheep = data.sheep || [];
      cows = data.cows || [];
      bamboo = data.bamboo || [];
      cacti = data.cacti || [];
      achievements = data.achievements || achievements;
      playerHP = data.playerHP !== undefined ? data.playerHP : 20;
      day = data.day !== undefined ? data.day : 1;
    } else {
      generateMapForBiome();
    }
  } catch (e) {
    console.warn("BÅ‚Ä…d podczas Å‚adowania zapisu:", e);
    generateMapForBiome();
  }

  updateWeather();
  renderBoard();
  generateMapForBiome();
  updateDayCounter();
}

function resetGame() {
  inventory = {
    sticks: 0, stones: 0, wood: 0, meat: 0, apples: 0, tomatoes: 0, sand: 0, coal: 0, cactus: 0, campfires: 0, bones: 0, cactusFlower: 0, chairs: 0, carrots: 0, sword: false, swordDurability: 0, wool: 0, arrows: 0, tomatoSoup: 0, stonePickaxe: false, pumpkinSoup: 0, stonePickaxeDurability: 0, pumpkins: 0,axe: false, axeDurability: 0, sheep: 0, cookedMeat: 0, spiderSilk: 0, spider: 0, dagger: false, daggerDurability: 0
  };

  playerHP = 20;
  playerX = 0;
  playerY = 0;
  worldX = 0;
  worldY = 0;
  isDay = true;
  day = 1;
  
  achievements.forEach(a => a.unlocked = false);

  sticks = [];
  stones = [];
  trees = [];
  pigs = [];
  tomatoes = [];
  sand = [];  
  arrows = [];  
  cacti = [];
  campfires = [];
  carrots = [];
  coal = [];
  wolves = [];
  sheep = [];
  bamboo = [];
  skeletons = [];
  spider = [];
  merchant = null;
  worlds = {};

  localStorage.removeItem('survivalGame');
  updateWeather();
  generateMapForBiome();
  renderBoard();
  updateInventory();
  updateTimeLabel();
  updateDayCounter();
}

document.addEventListener('keydown', e => {
  if (e.key === 'w' || e.key === 'W') move('up');
  if (e.key === 's' || e.key === 'S') move('down');
  if (e.key === 'a' || e.key === 'A') move('left');
  if (e.key === 'd' || e.key === 'D') move('right');
});

setInterval(toggleDayNight, 30000);
loadGame();
</script>

</body>
</html>
